From 698b07a2639e31a8648eee83065356c5b1cbe063 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Tue, 1 Dec 2020 14:40:25 +0200
Subject: [PATCH 41/45] ucm-imx8m-mini: dts: Use the KD7 in the main dts

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/Makefile              |  2 +-
 .../boot/dts/compulab/ucm-imx8m-mini-kd7.dtsi      | 66 ++++++++++++++++++++++
 arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dts    |  2 +
 3 files changed, 69 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx8m-mini-kd7.dtsi

diff --git a/arch/arm64/boot/dts/compulab/Makefile b/arch/arm64/boot/dts/compulab/Makefile
index 926645ac458c..2a829d942b38 100644
--- a/arch/arm64/boot/dts/compulab/Makefile
+++ b/arch/arm64/boot/dts/compulab/Makefile
@@ -2,7 +2,7 @@ dtb-$(CONFIG_ARCH_FSL_IMX8MM) += ucm-imx8m-mini.dtb
 dtb-$(CONFIG_ARCH_FSL_IMX8MM) += ucm-imx8m-mini-thermal.dtb
 dtb-$(CONFIG_ARCH_FSL_IMX8MM) += ucm-imx8m-mini-lvds.dtb
 dtb-$(CONFIG_ARCH_FSL_IMX8MM) += ucm-imx8m-mini-dsi2.dtb
-dtb-$(CONFIG_ARCH_FSL_IMX8MM) += ucm-imx8m-mini-kd7.dtb
+#dtb-$(CONFIG_ARCH_FSL_IMX8MM) += ucm-imx8m-mini-kd7.dtb
 
 always         := $(dtb-y)
 subdir-y       := $(dts-dirs)
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx8m-mini-kd7.dtsi b/arch/arm64/boot/dts/compulab/ucm-imx8m-mini-kd7.dtsi
new file mode 100644
index 000000000000..39d1e22aec78
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx8m-mini-kd7.dtsi
@@ -0,0 +1,66 @@
+&iomuxc {
+	sb-mcm-imx8-kd7 {
+		pinctrl_kd070hdf: kd070hdf_csgrp {
+			fsl,pins = <
+				MX8MM_IOMUXC_SAI5_RXD2_GPIO3_IO23	0x40000	 /* Reset DISP */
+			>;
+		};
+
+		pinctrl_goodix: goodix_gpios {
+			fsl,pins = <
+				MX8MM_IOMUXC_GPIO1_IO01_GPIO1_IO1	0x00
+				MX8MM_IOMUXC_SAI5_RXD1_GPIO3_IO22	0x40000  /* Reset TOUCH */
+			>;
+		};
+	};
+};
+
+&mipi_dsi {
+ 	status = "okay";
+ 	panel: panel@0 {
+		compatible = "startek,kd070hdf";
+		reg = <0>;
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_kd070hdf>;
+		reset-gpio = <&gpio3 23 GPIO_ACTIVE_HIGH>;
+		dsi-lanes = <4>;
+		status = "okay";
+		panel-width-mm = <154>;
+		panel-height-mm = <86>;
+		display-timings {
+			timing {
+				clock-frequency = <51206000>;
+				hactive = <1024>;
+				vactive = <600>;
+				hback-porch = <200>;
+				hfront-porch = <80>;
+				vback-porch = <30>;
+				vfront-porch = <10>;
+				hsync-len = <4>;
+				vsync-len = <4>;
+				hsync-active = <0>;
+				vsync-active = <0>;
+				de-active = <1>;
+				pixelclk-active = <1>;
+			};
+		};
+	};
+};
+
+&wm8731 {
+	status = "disabled";
+};
+
+&ov5640_mipi {
+	status = "disabled";
+};
+
+&touch_screen {
+	compatible = "goodix,gt9271";
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_goodix>;
+	reset-gpios = <&gpio3 22 GPIO_ACTIVE_HIGH>;
+	touchscreen-inverted-x;
+	touchscreen-inverted-y;
+	status = "okay";
+};
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dts b/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dts
index 2edf9d7d066a..00e02fcc4ae6 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dts
@@ -869,3 +869,5 @@
 		status = "okay";
 	};
 };
+
+#include "ucm-imx8m-mini-kd7.dtsi"
-- 
2.11.0

